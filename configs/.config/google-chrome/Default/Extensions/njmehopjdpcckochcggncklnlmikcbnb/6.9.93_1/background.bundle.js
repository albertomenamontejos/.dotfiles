(()=>{"use strict";const e="https://members.helium10.com",t=`https://members.helium10.com/extension/check-login?appId=${chrome.runtime.id}`,n={extendedInformation:!0,listingHealthScore:!0,bsrGraph:!0,pageWidget:!0,searchExpander:!0,factor:"two",score:{revenue:5e3,reviews:75},language:"en"};var o,r,a=Object.defineProperty,s=Object.defineProperties,c=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,d=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))i.call(t,n)&&d(e,n,t[n]);if(l)for(var n of l(t))u.call(t,n)&&d(e,n,t[n]);return e},m=(e,t)=>s(e,c(t)),p=(e,t,n)=>new Promise(((o,r)=>{var a=e=>{try{c(n.next(e))}catch(e){r(e)}},s=e=>{try{c(n.throw(e))}catch(e){r(e)}},c=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,s);c((n=n.apply(e,t)).next())}));chrome.runtime.setUninstallURL?chrome.runtime.setUninstallURL("https://survey.survicate.com/3ac7225d2fd0a9c0/?p=anonymous"):console.log("DISABLED UNINSTALL URL");const g=(t,n,o)=>{var r,a;if(t.type){switch(t.type){case"check-login":y().then(o);break;case"new-incognito-tab":chrome.windows.create(m(h({},t.details),{incognito:!0}),o);break;case"open-page":return chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const n=e[0].index;chrome.tabs.create({url:t.params.url,index:n+1})})),!1;case"open-page-and-xray":return chrome.tabs.query({active:!0,currentWindow:!0},(e=>p(void 0,null,(function*(){const n=e[0].index;chrome.tabs.create({url:t.params.url,index:n+1}).then((e=>{setTimeout((()=>chrome.tabs.sendMessage((null==e?void 0:e.id)||0,{type:"open-black-box"})),3e3)}))})))),!1;case"open-page-and-walmart-xray":return chrome.tabs.query({active:!0,currentWindow:!0},(e=>p(void 0,null,(function*(){const n=e[0].index;chrome.tabs.create({url:t.params.url,index:n+1}).then((e=>{setTimeout((()=>chrome.tabs.sendMessage((null==e?void 0:e.id)||0,{type:"open-xray-walmart"})),3e3)}))})))),!1;case"reload-tabs":f();break;case"send-launch-information":fetch(`${e}/extension/launch-uses?key=${t.key}`,{method:"GET",credentials:"same-origin"}).then((e=>{if(200!==e.status)throw e})).catch((e=>{console.log("%cExtension Launch error","color: #FF4081",e)}));break;case"background-request":fetch(t.url,t.params).then((e=>p(void 0,null,(function*(){const t=e.headers.get("content-type"),n=t&&-1!==t.indexOf("amazonui-streaming"),o=t&&-1!==t.indexOf("application/json"),r=n?yield e.text():null,a=o&&!n?yield e.json():null;return{data:r||a,status:e.status}})))).then(o).catch((e=>{o({data:null,status:(null==e?void 0:e.status)||500,error:e})}));break;case"host-request":fetch(t.url,t.params).then((e=>p(void 0,null,(function*(){return{data:yield e.text(),status:e.status}})))).then(o).catch((e=>{o({data:null,status:"500",error:e})}));break;case"form-data-request":{const e=e=>{const t=new FormData;for(const n in e)t.append(n,e[n]);return t};fetch(t.url,m(h({},t.params),{body:e(t.params.body)})).then((e=>p(void 0,null,(function*(){const t=e.headers.get("content-type");return{data:t&&-1!==t.indexOf("application/json")?yield e.json():null,status:e.status}})))).then(o).catch((e=>{o({data:null,status:"500",error:e})}));break}case"download":{const e=new URL(t.url),n=new URLSearchParams(e.search);t.isProductPage&&n.append("psc","1"),e.search=n.toString(),fetch(e.toString(),{method:"GET",credentials:"same-origin"}).then((e=>{if(200===e.status)return e.text();throw e})).then((e=>{"function"==typeof o&&o({err:!1,data:e})})).catch((e=>{console.log("%cDownload Error","color: #FF4081",e),"function"==typeof o&&o({err:!0})}));break}case"open-options":null==(a=(r=chrome.runtime).openOptionsPage)||a.call(r);break;case"check-shopify":try{fetch(t.url+"/cart.json").then((e=>{200===e.status?e.json().then((e=>{o(e.hasOwnProperty("currency")&&e.hasOwnProperty("token"))})):o(!1)}))}catch(e){o(!1)}}return!0}},w=(e,t)=>void 0===e?t:e,v=e=>{chrome.storage.local.clear(),y().then(),"install"===e.reason&&(chrome.storage.sync.set({extensionEnabled:!0,settings:n}),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0].index;chrome.tabs.create({url:"https://members.helium10.com/user/signup?type=chrome-extension",index:t+1})}))),"update"===e.reason&&chrome.storage.sync.get(["settings","options"],(e=>{(e=>{var t,o,r,a,s,c,l,i,u,d,h;let m=e.settings||n;e.settings||(e.options&&(m={extendedInformation:w(null==(t=e.options)?void 0:t.showExtInfo,!0),listingHealthScore:w(null==(o=e.options)?void 0:o.showListingHealth,!0),bsrGraph:w(null==(r=e.options)?void 0:r.showBsrGraph,!0),pageWidget:w(null==(a=e.options)?void 0:a.showXrayWidget,!0),searchExpander:w(null==(s=e.options)?void 0:s.searchExpander,!0),factor:(null==(l=null==(c=e.options)?void 0:c.successScore)?void 0:l.multiFactor)?"multi":"two",language:"en",score:{revenue:w(null==(u=null==(i=e.options)?void 0:i.successScore)?void 0:u.revenue,n.score.revenue),reviews:w(null==(h=null==(d=e.options)?void 0:d.successScore)?void 0:h.reviews,n.score.reviews)}}),chrome.storage.sync.set({settings:m}))})(e)})),"update"!==e.reason&&"install"!==e.reason||f()},b=()=>{chrome.permissions.contains({origins:["*://*/*"]},(e=>{e&&chrome.tabs.query({currentWindow:!0,active:!0},(e=>{var t;chrome.tabs.update((null==(t=e[0])?void 0:t.id)||0,{url:e[0].url})}))}))};null==(r=null==(o=chrome.storage)?void 0:o.onChanged)||r.addListener((e=>{for(const t in e)"extensionEnabled"===t&&f()}));const f=()=>{chrome.tabs.query({url:L},(e=>{var t,n;if(chrome.runtime.lastError)console.log(chrome.runtime.lastError.message);else for(let o=0;o<e.length;o++){const r=e[o].url;r&&(/#install-extension/.test(r)?chrome.tabs.reload((null==(t=e[o])?void 0:t.id)||0):/amazon|helium10|walmart/.test(r)&&chrome.tabs.reload((null==(n=e[o])?void 0:n.id)||0))}}))},y=()=>p(void 0,null,(function*(){yield fetch(t).then((e=>p(this,null,(function*(){const t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?yield e.json():null})))).then((e=>{var t;chrome.storage.local.set({subscription:e.plan,canApplyCoupon:(null==(t=e.upsellInfo)?void 0:t.canApplyCoupon)||!1,accountId:e.accountId,basePlan:e.basePlan,onboardingStatus:e.onboardingStatus}),chrome.storage.sync.set({subscription:e.plan,isUserLogged:e.logged,activeExperiments:e.activeExperiments||{}})})).catch((e=>{console.log("%c Check login error","color: #FF4081",e)}))})),x=()=>p(void 0,null,(function*(){var t,n;null==(n=null==(t=null==chrome?void 0:chrome.storage)?void 0:t.local)||n.get(["userHasToken"],(t=>{var n,o;t.userHasToken&&(null==(o=null==(n=null==chrome?void 0:chrome.storage)?void 0:n.local)||o.get(["accountId"],(t=>{if(null==t?void 0:t.accountId){const o=(n=t.accountId,`${e}/api/v1/notification/check-unread?source=Alerts${n?"&accountId="+n:""}`);fetch(o).then((e=>p(this,null,(function*(){var t,n,o,r;401!==e.status&&403!==e.status||(null==(n=null==(t=null==chrome?void 0:chrome.storage)?void 0:t.local)||n.set({accountId:null}),null==(r=null==(o=null==chrome?void 0:chrome.storage)?void 0:o.local)||r.set({userHasToken:!1}));const a=e.headers.get("content-type");return a&&-1!==a.indexOf("application/json")?yield e.json():null})))).then((e=>{if(null==e?void 0:e.unreadCount){const t=e.unreadCount>999?"999+":String(e.unreadCount);chrome.action.setBadgeBackgroundColor({color:"#f64f45"},(()=>chrome.action.setBadgeText({text:t})))}chrome.action.setBadgeText({text:""})})).catch((e=>{console.log("%c Check new alerts error","color: #FF4081",e),chrome.action.setBadgeText({text:""})}))}var n})))}))})),k=e=>{chrome.tabs.get(e.tabId,(t=>{void 0===chrome.runtime.lastError&&t.url&&E(e.tabId,t.url)}))},I=(e,t,n)=>{n.url&&E(e,n.url)},E=(e,t)=>{chrome.storage.sync.get("extensionEnabled",(n=>{const o=Boolean(n.extensionEnabled);chrome.permissions.contains({origins:[t]},(t=>{var n,r,a;t&&o?null==(n=chrome.action)||n.setIcon({path:"icon/16.png",tabId:e}):(null==(r=chrome.action)||r.setTitle({title:"Helium 10 disabled",tabId:e}),null==(a=chrome.action)||a.setIcon({path:"icon/16-off.png",tabId:e}))}))}))},L=["*://www.amazon.com/*","*://www.amazon.com.au/*","*://www.amazon.com.mx/*","*://www.amazon.co.uk/*","*://www.amazon.co.jp/*","*://www.amazon.ca/*","*://www.amazon.nl/*","*://www.amazon.fr/*","*://www.amazon.de/*","*://www.amazon.it/*","*://www.amazon.es/*","*://www.amazon.in/*","*://www.amazon.ae/*","*://www.helium10.com/*","*://members.helium10.com/*","*://*.alibaba.com/*","*://*.walmart.com/*"];chrome.runtime.lastError?console.log(chrome.runtime.lastError.message):(chrome.runtime.onMessage.addListener(g),chrome.runtime.onMessageExternal.addListener(g),chrome.runtime.onInstalled.addListener(v),chrome.tabs.onActivated.addListener(k),chrome.tabs.onUpdated.addListener(I),chrome.permissions.onAdded.addListener(b),setInterval((()=>x()),36e5))})();